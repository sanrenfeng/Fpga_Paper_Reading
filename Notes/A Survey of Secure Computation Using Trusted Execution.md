### **A Survey of Secure Computation Using Trusted Execution Environments**

​									**使用可信执行环境的安全计算综述**

#### 摘要

- TEE 在确保机密性和完整性的前提下，允许人们在本地和外部数据上启动计算任务
- 这篇论文主要是对基于 TEE 的安全计算协议进行了系统的回顾和比较。
  - 提出分类法：安全外包计算、安全分布式计算和安全多方计算
  - 为进行比较，提出综合评估标准：设置、方法、安全、性能
  - 该论文是第一个回顾基于tee的安全计算协议的调查，综合比较、并讨论了一些未来的研究方向和挑战。

#### **Introduction**

- 安全计算背景：

  - 为了消除部署和维护高性能计算基础设施的负担和成本，现在许多组织都求助于云服务。尽管如此，在这种外部计算模型下，云服务器可能会为自己的利益提取有价值的或敏感的信息，这可能会损害数据所有者的利益。此外，在涉及多个数据源的计算任务中，保护每个数据所有者的利益也是一个必要的要求。作为一般术语，安全计算是指在整个计算过程中能够确保数据隐私和/或完整性的技术。

  - 一般来说，现有的安全计算框架主要针对加密或模糊的输入来评估一个函数。它的实际形式取决于计算任务和设置。例如，在多方设置中，安全计算允许具有私有输入的多方基于所有私有输入来评估联合函数，例如拍卖场景中的排序函数。
  
- 安全计算目标和挑战: 

  - **在计算过程中，需要确保每个单独输入的隐私性以及输出的正确性/完整性。在外包计算设置中，安全计算允许多个客户端将可能涉及敏感数据的计算任务外包给不受信任的云服务器。安全计算的主要挑战是：在存在不受信任或恶意的各方参与计算的情况下，我们如何安全和有效地评估基于私有输入上的函数？**

- 安全计算的发展历程：

  - 用于安全计算的加密方法： 在过去的40年里，许多密码原语和协议被提出来解决安全计算问题。
    -  Yao 's garbled circuits ( GC )
    - GMW 's scheme
    -  cut-and-choose mechanism 扩展了 GC 以对抗恶意对手
    -  dual execution 改进了 GMW 's scheme，实现了更强的安全性。
    - Oblivious RAM（ORAM）
      - 基于 ORAM 的方法是，构建共享的 ORAM，然后通过 CPU 和共享内存之间的多轮交互来实现数据隐私。由于所有这些交互都是加密的，并且共享的 ORAM 在访问数据时对数据进行重新加密和打乱，因此低效率成为一个主要缺点。
    - 同态加密（HE）
      - 基于 HE 的解决方案允许直接在密文上进行计算，但是其中一些解决方案（PHE ，SWHE ）不能支持任意计算，而其他解决方案（如 FHE）由于大量的计算成本仍然不切实际。
    - 秘密共享（SS）
      - 基于 SS 的解决方案将一个秘密分成多个共享，然后将它们分配给两个或多个玩家。有了共享，我们可以从中重建原始的秘密（例如，通过拉格朗日插值）。近年来，秘密共享已经显示出其优越性，并在一些安全计算的混合框架中作为一个重要的组成部分，如ABY 和ABY2.0。
    - 然而，由于上述加密方法具有强信任假设或广泛的计算和通信开销，特别是在处理复杂的计算任务或大型数据集时，它们仍未被广泛采用。许多方法假设参与的各方是半诚实的，这意味着这些各方尽管对他人的私人投入感到好奇，但仍会诚实地遵循协议步骤。这种假设在许多应用领域中并不成立，在这些应用领域中，各方有动机通过偏离协议规范来获得比其竞争对手更多的利益或优势。另一方面，使用纯基于加密的解决方案来保护恶意各方会带来很大的开销。我们注意到，在半诚实设置中工作的安全计算协议可以转换为保护恶意参与者，但需要大量的计算和通信成本。
  - **基于TEE的安全计算**。今天，人们对可信执行环境（TEE ）的日益认识，吸引了许多爱好者去探索构建实用的通用/特殊目的安全计算协议。**多亏了可信的硬件，基于tee的安全的计算协议被证明比传统的基于加密的方法更有效，同时提供了机密性和完整性的保证**。因此，TEE是一种很有前途的技术，为实际应用实现实用和可扩展的安全计算。本文回顾和比较了最先进的基于tee的安全计算协议，并讨论了剩余的挑战、开放的问题和未来的研究方向。

- TEE 背景

  - TEE提供了一个隔离的环境（称为安全飞地），通过加密传入和传出的数据来保护已处理的数据。此外，TEE还提供了一些机制，以确保计算被正确地执行，并保证了完整性。更重要的是，TEE保护数据和计算抵抗驻留在系统中的任何潜在恶意实体（包括内核、管理程序等）。

  - TEE 特点

    - 通用目的计算

      - 在TEE中执行的函数通常表示为用户定义的程序；因此，它允许广泛的函数。

    - 完整性和隐私性。TEE提供了对完整性和保密性的保证。机密性意味着攻击者无法从计算中获得敏感信息，而完整性可以确保程序的正确执行。
    - 高性能。TEE通过解密飞地中的所有加密输入并在明文上执行程序来计算用户定义的程序。因此，它享有CPU 速度性能，除了处理加密输入的开销外。
    
  - TEE 分类
  
    - 根据设计，目前的TEE可以分为两类
      1. 没有安全计数器的TEE ：只支持简单的无状态功能（如智能卡）
      2. 有安全计数器的TEE ： 支持复杂的有状态函数。近年来，许多TEE的设计都集中于后者，如可信平台模块（TPM/vTPM）、Intel TXT 、Intel SGX 、ARM的信任区、Sanctum 、KeyStone 和AMD SEV。这些设计在体系结构选择、指令集、实现细节、加密套件以及安全特性方面存在很大差异。
  
  - 安全机制
  
    - TEE展示了广泛的安全特性，以实现计算的机密性和完整性。由于这些特性，TEE已被复杂的安全系统广泛采用。下面我们将介绍与安全计算相关的几个基本特征 :
      - 安全的 boot 。当主机启动时，安全引导程序将不可变和经过验证的镜像加载到一个飞地中，以确保飞地镜像、操作系统组件和配置之间的信任链。在操作系统启动之前，一个安全的 boot 可以确保 TEE 被正确地加载，并且主机，甚至是系统管理程序，都不能篡改它。
      - 认证。认证通过建立一个安全的通道，在一个飞地和另一个飞地或一个远程机器之间建立信任。一般有两种认证机制：本地认证和远程认证。虽然同一平台上的两个飞地可以使用本地认证相互证明，但远程认证允许客户端验证其程序在远程服务器中正确配置和执行（即未被修改或篡改）。
      - 隔离的执行。TEE 将用户定义的程序加载到飞地中，然后对每个程序执行隔离执行。在执行期间，敏感数据(包括代码和数据) 在 PRM（处理器保留内存）中的 EPCs（飞地页面缓存）中维护，这是在引导阶段的 DRAM 中预配置的。加载在飞地内的代码可以访问非 PRM 和 PRM 内存。另一方面，外部程序不能访问 PRM 内存中的任何数据。 
      - 密封。密封是一种让 TEE 安全地保存并检索本地磁盘上的“秘密” 的机制。密封通过从 CPU 硬件派生的密封密钥将秘密绑定到一个特定的飞地身份。TEE 使用密封密钥加密了这块飞地的秘密，并将其存储在一个本地磁盘上。相反，TEE通过开封机制从磁盘中检索秘密。
  
  - 漏洞
  
    - 尽管TEE很吸引人，但它也容易受到几次攻击，下面我们将简要回顾两个会影响安全计算的主要攻击。
  
      - 首先，TEE可能会遭受侧通道攻击，从而破坏数据隐私。
  
        - 定时侧通道。给定不同的输入，程序在飞地的运行时间也可能不同。通过监视执行时间上的差异，攻击者可以获得有关输入的一些敏感信息，例如，反映循环执行次数的秘密值。
          - 要解决这个问题，一种方法是确保加载到飞地的程序总是花费大约相同的执行时间。
      
      
        - 内存侧通道。在一些程序中，对非 PRM 内存的访问模式可能取决于飞地的秘密。例如，如果飞地运行一个二进制搜索程序，访问模式是从根节点到叶节点的路径，这可能会揭示真正的秘密。因此，加载的程序应该删除内存访问模式和内部秘密之间的任何关联。
      
        - 网络侧通道。在分布式系统中，网络访问模式（例如，排序或散列分区）可以揭示敏感信息。因此，网络接入协议也应该设计良好，以便不能从模式中推导出敏感信息。
      
      - 其次，TEE 也可能容易受到倒带攻击（或重放攻击），这使得攻击者可以主动重置计算的状态。请注意，这种攻击可能会导致有状态计算的灾难性后果，例如有限尝试密码检查。我们不能总是期望 TE E能够安全地维持这个状态，原因有两个。
      
        - TEE在实践中可能是无状态的。
        - 即使是有状态的TEE，有限的受保护内存也使它不能正确地保持一个大的状态。因此，设计者应该小心，并提供特殊的机制来对抗反向攻击。
      
    
  - 该论文贡献
  
    - 这项调查还旨在帮助非专业人员了解TEE支持的安全计算，并帮助实践者确定合适的TEE技术用于系统部署。
  
    - TEE 以 CPU Level 性能提供了一种很有前途的基于硬件的实现安全计算替代方案 ，从而弥合了学术研究和工业采用安全计算之间的差距。**可信硬件提供了强大的抽象来构建安全系统，可以应用于许多潜在的应用，如机器学习算法、云计算、区块链、网络流量分析、科学计算、数据分析和隐私保护的COVID-19 接触追踪。**为了帮助读者系统地感知基于 TEE 的安全计算协议的核心设计，他们对这一研究领域的研究现状进行了全面的综述。贡献总结如下：
  
      - 首先，我们从计算框架和 TEE 利用率的角度，提出了基于TEE 的安全计算协议的两种分类方法。
  
        - 根据框架，我们将安全计算协议分为安全外包计算（SOC）、安全分布式计算（SDC）和安全多方计算（SMC）。
  
        - 基于TEE的利用率，将现有协议分为三类： 基于纯 TEE 的协议，使用 TEE 作为黑盒; 具有遗忘原语的 TEE , 可以防止侧通道和泄漏攻击; 具有可信外壳的TEE,可以抵抗针对 TEE 状态的攻击。
    
      - 其次，提出了综合评估标准，以评估和比较现有的方案。评估标准由四个维度构成： 
        - 指定计算功能和框架的设置；
        - 描述 TEE 利用方法和所使用的附加加密原语的方法；
        - 突出协议的安全性特性，如隐私性、完整性、公平性和新鲜度；
        - 显示实验c的性能
    
      - 第三，根据上述评价标准，对现有方案进行综合比较。具体来说，本文首先比较了现有的通用安全计算的方案。然后对两个具体的计算任务进行了详细的比较： 机器学习，其中包括训练和推理；和加密数据库查询。
      - 最后，结合对当前最先进的基于TEE的安全计算解决方案的观察，我们讨论了未来的几个研究方向和挑战。
    

- 分类和评估标准 部分

  - 基于计算框架，我们将基于 TEE 的安全计算协议分为以下三类：

    - 安全的外包计算（SOC）。图显示了 SOC 的框架，其中数据所有者将加密的数据外包给单个云服务器。随后，经授权的数据用户将与云服务器运行 SOC 协议，以实现所需的计算任务。在实践中，单个云是一个不受信任的实体，它可能表现为被动/半诚实的攻击者或主动/恶意的攻击者。![image-20230914170614724](C:\Users\lijiayong\AppData\Roaming\Typora\typora-user-images\image-20230914170614724.png)

    - 安全的分布式计算（SDC）。图为 SDC 的框架，其中加密的数据外包给多台服务器。具体来说，一个主节点负责协调计算任务，而几个从节点以分布式的方式执行计算。SDC 协议在经授权的数据用户和这些服务器节点之间运行。具体来说，每个从节点计算一个中间结果，主节点用最终输出响应数据用户，最终输出由中间结果重建。主节点和从节点可能是半诚实的或恶意的。与 SOC 相比，服务器之间的交互和 SDC 中的中间结果向攻击者暴露了一个更大的攻击表面。

      ![image-20230914170646555](C:\Users\lijiayong\AppData\Roaming\Typora\typora-user-images\image-20230914170646555.png)

    - 安全的多方计算（SMC）。图显示了 SMC 的框架，其中数据所有者自己共同运行一个 SMC 协议，而不失去对其数据的控制。SMC 和SDC 的区别在于，SMC 不涉及一个主节点来协调计算任务。参与计算的数据所有者（也称为各方）彼此并不信任。具体来说，SMC 中的每一方都试图保护自己的敏感信息，免受其他可能半诚实甚至恶意行为（即通过破坏协议)。
    
      ![image-20230914221647165](C:\Users\lijiayong\AppData\Roaming\Typora\typora-user-images\image-20230914221647165.png)
    
  - 根据 TEE 的利用率，无论它是单独使用还是与其他工具一起使用来防止侧通道或与状态相关的攻击，我们还可以将协议分为以下类型：

    - 将 TEE 作为黑盒子。TEE 为通用计算提供机密和完整性保证，防止对手对手窃听。由于输入和输出是通过经过身份验证的加密方案（例如，AES-GCM）进行加密的，因此不受信任的主机无法学习敏感信息。许多现有的解决方案都将 TEE 视为一个黑盒子。如果一个协议需要一个有状态的硬件设备，我们将其标记为“有状态的 TEE ”；否则，我们标记为“无状态的 TEE ”。
    - 遗忘原语 TEE。如前所述，虽然主机不能直接访问 TEE 的状态，但敏感信息仍然可能通过不同的侧通道泄露。为了防止这种泄漏，我们利用精心设计的遗忘原语（OP）和差异遗忘性来减轻来自不同级别的侧通道攻击。由此产生的方案，如 ZeroTrace 和 ObliJoin，不仅实现了机密性和完整性，而且还避免了来自其他渠道的敏感信息泄漏。这一类中的协议被标记为“有状态 TEE+OP ”或“无状态 TEE+OP ” 来进行比较。
    - 带有可信的公共账本的 TEE 。当 TEE 部署在远程恶意主机上时，后者可能会向飞地提交非法输入。例如，在有状态计算中的倒带攻击中，主机可能会为飞地提供一个陈旧的加密状态，这可能会导致灾难性的影响。因此，可以引入一个可信的公共账本（PL），以确保输入状态的合法性，而这类协议被标记为“有状态 TEE + PL”或“无状态TEE + PL”以进行比较。

  - 评价标准

    - 设置、方法、安全性和性能

      <img src="C:\Users\lijiayong\AppData\Roaming\Typora\typora-user-images\image-20230914222619259.png" alt="image-20230914222619259" style="zoom:67%;" />

      - 设置。安全计算协议为不同的目的设计并且可以遵循不同的计算框架。为了实现公平的比较，我们将安全的计算设置分为两个方面：框架和功能，如上图。该框架指定了设计协议的架构，已在2.1 节中详细阐述。该函数代表了协议的主要目标，如机器学习任务（训练或推理）、科学计算（如矩阵乘法和多项式计算）、数据分析（如SQL查询和统计分析），或通用函数。

      - 方法。方法学描述了方案的设计原则，并将指导开发人员促进实际部署。我们从两个方面描述了基于 TEE 的协议的方法（如图2）: TEE的使用和加密原语。前者描述了在一个协议中是如何使用TEE的。后者提供了协议利用了哪些加密工具包。值得注意的是，许多加密原语被用于处理 TEE 之外的安全问题，如身份验证加密、数字签名、秘密共享和零知识证明。因此，我们也在比较中强调了加密原语。

      - 安全性。通常安全评估包括两个维度：安全目标和对抗性模型。根据系统需求，在不同的对抗性模型下定义了不同的安全目标。我们提出了共同的安全目标和对抗性模型如下。

        - 安全目标。安全目标定义了在安全计算协议中应该实现哪些安全需求。在本文中，我们考虑了四种类型的安全目标：隐私性、完整性、公平性和新鲜度。

          - 隐私。安全计算中的隐私意味着敏感数据（包括输入、中间结果、输出或计算期间的其他元数据，如访问模式）对潜在的攻击者不可见。此外，敏感数据可能包括隐私保护数据库查询中的具体查询，或隐私保护机器学习中的模型参数和推理数据。应保护所有敏感信息不会被泄露给任何未经授权的方（例如，云服务器）。
          - 完整性。安全计算的完整性意味着没有恶意方可以破坏协议的执行，并为其他方产生错误的输出。例如，在联邦机器学习中，一方可能会通过恶意训练其本地模型的来进行后门攻击，从而破坏训练模型的性能。
          - 新鲜度。安全计算的新鲜性意味着参与方不能利用陈旧状态或旧数据来进行有状态计算。例如，对手可以通过向诚实的方重新发送陈旧的有效信息来发起重放攻击，从而欺骗诚实的方。因此，双方之间传输的任何消息都应该通过新鲜度检查，以确保状态或数据是最新的。
          - 公平性。公平性是 SMC 中一种自然而可取的安全要求，在拍卖、合同签订、支付等应用场景中都表现出了公平性的重要性。公平性确保所有各方都收到协议输出，或者没有人收到。虽然一般计算的完全公平是不可能的，但已经提出了一些可能的和有用的公平解决方案，如渐进释放、概率公平、乐观交换、公平与惩罚和Δ-公平。

        - 对抗性模型。对抗性模型抽象了攻击者的力量。一般来说，安全计算协议会考虑两种类型的攻击者：半诚实攻击者和恶意攻击者。

          - 半诚实。一个半诚实的对手，也被称为诚实但好奇的对手，被认为是诚实地遵守协议的指示，以便正确地执行和完成任务。然而，攻击者很好奇，并试图从计算的每一步中学习敏感信息。

          - 恶意的。一个恶意的对手比半诚实的对手更强大，因为它可以任意地偏离规定的协议。恶意的对手可以通过主动攻击了解更多关于敏感数据的信息，或者通过执行惰性计算并将随机结果返回给其他诚实的各方来节省计算或存储成本。
      - 性能。我们从四个方面提出了性能评估标准：实验配置、成本、准确性和开源内容，具体阐述如下。
        - 我们应该注意的是，对安全计算协议的公平比较并不是一项简单的任务，因为性能指标可以从不同的数据集获得，并以许多不同的方式显示出来。因此，我们不能比较在相同的实验配置下的所有协议。相反，我们的目标是基于以下四个方面提供一个相对客观的比较。

        - 实验配置。实验配置是多种多样的，如计算机规范、平台、工作负载、数据集和网络架构。因此，我们将在比较中指定必要的实验配置，这也将有助于读者理解在实际部署中的性能。

        - 成本。安全计算以许多不同的方式表现出它们的性能，例如无实验的复杂性估计、绝对时间消耗、表示相对成本、吞吐量或其他成本的百分比。为了保持尽可能的统一，我们在比较中给出了它的基线。具体来说，将考虑以下基线。

        - 明文模型。明文模型意味着该函数是在 TEE 之外计算的，没有任何保护，这表现出异常高的性能。与明文模型相比，协议的性能会更差，我们在比较中强调了“减速”因素。

        - 完全在飞地模型。完全在飞地模型意味着整个计算任务在飞地中完成，这可能会触发 TEE 的页面交换，从而导致较大的TCB 大小和更差的性能。一个设计良好的协议的性能通常会比完全在飞地模型中更好，我们在比较中强调了“加速”的因素。

        - 艺术状态。一些参考文献将他们的协议与现有的技术水平进行了比较。相比之下，我们强调了“放缓”或“加速”的因素。
          - 精度。准确性是许多机器学习算法中的一个基本标准。非正式地说，准确性是模型得到正确的预测的比例，而高精度是首选。一般安全计算的准确性意味着应该返回绝对正确的结果。然而，基于差异隐私的解决方案为结果增加了噪声扰动，以满足特定的隐私要求，因此可能不会产生绝对正确的结果。
          - 开源。最后但并非最不重要的是，我们还总结了一个实现的协议是否开源，这可以帮助其他研究人员找到。

  - 路线图

    - 图中显示了本次调查的路线图。已完成的调查由主要部分和附加的补充材料组成。

      - 主要部分，基于 TEE 的安全的通用功能和机器学习计算协议在第三节和第四节中进行了顺序回顾。

      - 在补充材料中，在第 A 节我们回顾了基于 TEE 的数据库查询安全计算协议。在每一节中，我们将介绍关于不同框架的问题陈述和研究状态。例如第三节回顾了基于 TEE 的协议的通用安全计算。按照 2.1 节中提出的分类法，我们在 3.1、3.2、3.3 中介绍了 SOC、SDC 和 SMC。在那之后，我们在 3.4 节提供了全面的比较。根据 2.2 节中显示的评估标准。作为安全计算的两个重要和特殊的研究方向，我们在第四节组织了机器学习的内容，和第A节组织了数据库查询。最后，在第五中提出了总结和未来的方向。 

        ![image-20230914224844117](C:\Users\lijiayong\AppData\Roaming\Typora\typora-user-images\image-20230914224844117.png)

  - 使用 TEE 完成安全计算

    - 在本节中，将讨论和比较使用 TEE 的现有通用安全计算协议。根据不同的框架，我们先后提出了安全外包计算、安全的分布式计算和安全的多方计算。
      - 安全外包计算
